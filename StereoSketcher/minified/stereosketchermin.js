function selectAllContiguous(e,t){var n=getDots();var r;if(!t.shiftKey){deselectAll()}else{for(var i=0;i<n.length;i++){r=n[i];if(r.isSelected()){r.deselect();addClassToElement(r,"tempSelect")}}}e.select();recursiveSelectDots(e);n=getDots();for(var i=0;i<n.length;i++){r=n[i];if(doesElementHaveClass(r,"tempSelect")){r.select();removeClassFromElement(r,"tempSelect")}}}function lowlightAll(){var e=shapeGroup.getElementsByClassName("highlit");for(var t=0;t<e.length;t++){e[t].lowlight()}}function selectDotsOfLine(e,t){if(!t.shiftKey){deselectAll()}e.dot1.select();e.dot2.select()}function selectDotsOfFace(e,t){if(!t.shiftKey){deselectAll()}e.dot1.select();e.dot2.select();e.dot3.select()}function recursiveSelectDots(e){var t=e.lines;var n;for(var r=0;r<t.length;r++){n=t[r];if(n.dot1.isSelected()&&n.dot2.isSelected()){continue}if(n.dot1==e){n.dot2.select();recursiveSelectDots(n.dot2)}else if(n.dot2==e){n.dot1.select();recursiveSelectDots(n.dot1)}}var i=e.faces;var s;for(var r=0;r<i.length;r++){s=i[r];if(s.dot1.isSelected()&&s.dot2.isSelected()&&s.dot3.isSelected()){continue}if(s.dot1==e){if(!s.dot2.isSelected()){s.dot2.select();recursiveSelectDots(s.dot2)}if(!s.dot3.isSelected()){s.dot3.select();recursiveSelectDots(s.dot3)}}if(s.dot2==e){if(!s.dot1.isSelected()){s.dot1.select();recursiveSelectDots(s.dot1)}if(!s.dot3.isSelected()){s.dot3.select();recursiveSelectDots(s.dot3)}}if(s.dot3==e){if(!s.dot2.isSelected()){s.dot2.select();recursiveSelectDots(s.dot2)}if(!s.dot1.isSelected()){s.dot1.select();recursiveSelectDots(s.dot1)}}}}function deselectAllDots(){var e;var t=getDots();for(var n=0;n<t.length;n++){e=t[n];e.deselect()}}function deselectAll(){deselectAllDots();var e;var t=getLines();for(var n=0;n<t.length;n++){e=t[n];e.deselect()}var r;var i=getFaces();for(var s=0;s<i.length;s++){r=i[s];r.deselect()}}function sampleColor(){var e=null;var t=getLinesAndFaces();var n;for(var r=0;r<t.length;r++){n=t[r];if(n.isSelected()){if(e!=null){return}else{e=n}}}if(e==null)return;document.getElementById("colorPicker").color.fromString(e.color)}function setColor(){var e=document.getElementById("colorPicker").value;var t=getFaces();var n;for(var r=0;r<t.length;r++){n=t[r];if(n.isSelected()){n.color=e;n.setAttribute("fill",e);n.clone.setAttribute("fill",e);n.under.setAttribute("fill",e);n.clone.under.setAttribute("fill",e);n.under.setAttribute("stroke",e);n.clone.under.setAttribute("stroke",e)}n.deselect()}var i=getLines();var s;for(var r=0;r<i.length;r++){s=i[r];if(s.isSelected()){s.color=e;s.setAttribute("stroke",e);s.clone.setAttribute("stroke",e)}s.deselect()}}function setBackground(){var e=document.getElementById("colorPicker").value;svg.setAttribute("style","background: "+e)}function sampleBackground(){document.getElementById("colorPicker").color.fromString(getBackgroundColor())}function getBackgroundColor(){var e=svg.getAttribute("style");return e.substr(e.indexOf("#"))}function hideColorPicker(){var e=document.getElementById("colorPicker");e.color.hidePicker();e.blur()}function showColorPicker(){var e=document.getElementById("colorPicker");e.color.showPicker()}function changeSelectangle(e){if(selectangle!=null){var t=parseFloat(selectangle.getAttribute("x"));var n=parseFloat(selectangle.getAttribute("y"));var r=parseFloat(selectangle.getAttribute("width"));var i=parseFloat(selectangle.getAttribute("height"));var s=e.clientX;var o=e.clientY;if(selectangle.originalX<s){selectangle.setAttribute("width",s-t);selectangle.setAttribute("x",selectangle.originalX)}else{selectangle.setAttribute("width",selectangle.originalX-s);selectangle.setAttribute("x",s)}if(selectangle.originalY<o){selectangle.setAttribute("height",o-n);selectangle.setAttribute("y",selectangle.originalY)}else{selectangle.setAttribute("height",selectangle.originalY-o);selectangle.setAttribute("y",o)}}else{createSelectangle(e)}}function createSelectangle(e){selectangle=document.createElementNS("http://www.w3.org/2000/svg","rect");selectangle.setAttribute("x",e.clientX);selectangle.setAttribute("y",e.clientY);selectangle.setAttribute("fill-opacity",0);selectangle.setAttribute("stroke","black");selectangle.setAttribute("stroke-width",2);selectangle.setAttribute("stroke-opacity",1);selectangle.setAttribute("height",0);selectangle.setAttribute("width",0);selectangle.originalX=e.clientX;selectangle.originalY=e.clientY;svg.appendChild(selectangle)}function dragDots(e,t){var n=e.clientX-prevX;var r=e.clientY-prevY;var i;for(var s=0;s<t.length;s++){i=t[s];moveDot(i,n,r)}prevX=e.clientX;prevY=e.clientY}function moveDot(e,t,n){var r;var i;var s=0;var o=0;var u=[];var a=[];var f=0;var l=0;var c=0;var h=0;var p=0;var d=0;var v="";var m="";s=parseFloat(e.getAttribute("cx"))+t;o=parseFloat(e.getAttribute("cy"))+n;e.setAttribute("cx",s);e.setAttribute("cy",o);u=e.lines;for(var g=0;g<u.length;g++){r=u[g];if(r.dot1==e){r.setAttribute("x1",s);r.setAttribute("y1",o);r.clone.setAttribute("x1",s+IPD+e.shift*shiftSpeed);r.clone.setAttribute("y1",o)}else if(r.dot2==e){r.setAttribute("x2",s);r.setAttribute("y2",o);r.clone.setAttribute("x2",s+IPD+e.shift*shiftSpeed);r.clone.setAttribute("y2",o)}}a=e.faces;for(var y=0;y<a.length;y++){i=a[y];if(i.dot1==e){f=s;l=o;c=i.dot2.getAttribute("cx");h=i.dot2.getAttribute("cy");p=i.dot3.getAttribute("cx");d=i.dot3.getAttribute("cy");v=[f,",",l," ",c,",",h," ",p,",",d].join("");i.setAttribute("points",v);i.under.setAttribute("points",v);m=[s+IPD+i.dot1.shift*shiftSpeed,",",l," ",parseFloat(c)+i.dot2.shift*shiftSpeed+IPD,",",h," ",parseFloat(p)+i.dot3.shift*shiftSpeed+IPD,",",d].join("");i.clone.setAttribute("points",m);i.clone.under.setAttribute("points",m)}if(i.dot2==e){f=i.dot1.getAttribute("cx");l=i.dot1.getAttribute("cy");c=s;h=o;p=i.dot3.getAttribute("cx");d=i.dot3.getAttribute("cy");v=[f,",",l," ",c,",",h," ",p,",",d].join("");i.setAttribute("points",v);i.under.setAttribute("points",v);m=[parseFloat(f)+IPD+i.dot1.shift*shiftSpeed,",",l," ",s+i.dot2.shift*shiftSpeed+IPD,",",h," ",parseFloat(p)+i.dot3.shift*shiftSpeed+IPD,",",d].join("");i.clone.setAttribute("points",m);i.clone.under.setAttribute("points",m)}if(i.dot3==e){f=i.dot1.getAttribute("cx");l=i.dot1.getAttribute("cy");c=i.dot2.getAttribute("cx");h=i.dot2.getAttribute("cy");p=s;d=o;v=[f,",",l," ",c,",",h," ",p,",",d].join("");i.setAttribute("points",v);i.under.setAttribute("points",v);m=[parseFloat(f)+IPD+i.dot1.shift*shiftSpeed,",",l," ",parseFloat(c)+i.dot2.shift*shiftSpeed+IPD,",",h," ",s+i.dot3.shift*shiftSpeed+IPD,",",d].join("");i.clone.setAttribute("points",m);i.clone.under.setAttribute("points",m)}}e.label.setAttribute("x",parseFloat(e.getAttribute("cx"))+labelX);e.label.setAttribute("y",parseFloat(e.getAttribute("cy"))+labelY)}function addOverlaps(){var e;var t;var n;var r,i;var s;var o,u;var a;var f,l;var c;var h;var p;var d=getLines();var v=getFaces();var m=getLinesAndFaces();var g=getBackgroundColor();for(var y=0;y<m.length;y++){e=m[y];f=e.getBBox();e.overlaps=[];e.deselect();e.lowlight();if(doesElementHaveClass(e,"line")){e.setAttribute("stroke",getAnaglyphedColor(e.color,g));e.clone.setAttribute("stroke",getAnaglyphedColor(g,e.color))}else if(doesElementHaveClass(e,"face")){e.setAttribute("fill",getAnaglyphedColor(e.color,g));e.setAttribute("stroke",getAnaglyphedColor(e.color,g));e.under.setAttribute("fill",getAnaglyphedColor(e.color,g));e.under.setAttribute("stroke",getAnaglyphedColor(e.color,g));e.clone.setAttribute("fill",getAnaglyphedColor(g,e.color));e.clone.setAttribute("stroke",getAnaglyphedColor(g,e.color));e.clone.under.setAttribute("fill",getAnaglyphedColor(g,e.color));e.clone.under.setAttribute("stroke",getAnaglyphedColor(g,e.color))}for(var b=0;b<m.length;b++){p=m[b];l=p.getBBox();if(!doBoundingBoxesOverlap(f,l))continue;a=getAnaglyphedColor(e.color,p.color);c={};t=p.clone;h=document.createElementNS("http://www.w3.org/2000/svg","clipPath");h.setAttribute("id",["itemClip.",y,".",b].join(""));c.itemClip=createClipPath(e,h);h=document.createElementNS("http://www.w3.org/2000/svg","clipPath");h.setAttribute("id",["cloneClip.",y,".",b].join(""));c.cloneClip=createClipPath(t,h);if(doesElementHaveClass(e,"face")){r=document.createElementNS("http://www.w3.org/2000/svg","polygon");r.setAttribute("fill",a);r.setAttribute("points",e.getAttribute("points"));i=document.createElementNS("http://www.w3.org/2000/svg","polygon");i.setAttribute("fill",a);i.setAttribute("points",e.getAttribute("points"));i.setAttribute("stroke-width",faceSpaceCorrection);i.setAttribute("stroke",a);i.setAttribute("clip-path",["url(#cloneClip.",y,".",b,")"].join(""));i.setAttribute("class","itemOverlapUnder");forwardAllMouseEvents(i,e);shapeGroup.appendChild(i);c.itemOverlapUnder=i}else if(doesElementHaveClass(e,"line")){r=document.createElementNS("http://www.w3.org/2000/svg","line");r.setAttribute("x1",e.getAttribute("x1"));r.setAttribute("y1",e.getAttribute("y1"));r.setAttribute("x2",e.getAttribute("x2"));r.setAttribute("y2",e.getAttribute("y2"));r.setAttribute("stroke",a);r.setAttribute("stroke-width",lineThickness)}r.setAttribute("class","itemOverlap");forwardAllMouseEvents(r,e);shapeGroup.appendChild(r);r.setAttribute("clip-path",["url(#cloneClip.",y,".",b,")"].join(""));c.itemOverlap=r;if(doesElementHaveClass(t,"cloneFace")){o=document.createElementNS("http://www.w3.org/2000/svg","polygon");o.setAttribute("fill",a);o.setAttribute("points",t.getAttribute("points"));u=document.createElementNS("http://www.w3.org/2000/svg","polygon");u.setAttribute("fill",a);u.setAttribute("points",t.getAttribute("points"));u.setAttribute("stroke-width",faceSpaceCorrection);u.setAttribute("stroke",a);u.setAttribute("clip-path",["url(#itemClip.",y,".",b,")"].join(""));u.setAttribute("class","cloneOverlapUnder");forwardAllMouseEvents(u,e);shapeGroup.appendChild(u);c.cloneOverlapUnder=u}else if(doesElementHaveClass(t,"cloneLine")){o=document.createElementNS("http://www.w3.org/2000/svg","line");o.setAttribute("x1",t.getAttribute("x1"));o.setAttribute("y1",t.getAttribute("y1"));o.setAttribute("x2",t.getAttribute("x2"));o.setAttribute("y2",t.getAttribute("y2"));o.setAttribute("stroke",a);o.setAttribute("stroke-width",lineThickness)}o.setAttribute("class","cloneOverlap");shapeGroup.appendChild(o);forwardAllMouseEvents(o,e);o.setAttribute("clip-path",["url(#itemClip.",y,".",b,")"].join(""));c.cloneOverlap=o;e.overlaps.push(c)}}}function createClipPath(e,t){var n;if(doesElementHaveClass(e,"face")||doesElementHaveClass(e,"cloneFace")){n=document.createElementNS("http://www.w3.org/2000/svg","polygon");n.setAttribute("points",e.getAttribute("points"));t.appendChild(n)}else if(doesElementHaveClass(e,"line")||doesElementHaveClass(e,"cloneLine")){n=document.createElementNS("http://www.w3.org/2000/svg","polygon");var r=parseFloat(e.getAttribute("x1"));var i=parseFloat(e.getAttribute("y1"));var s=parseFloat(e.getAttribute("x2"));var o=parseFloat(e.getAttribute("y2"));var u=Math.atan((o-i)/(s-r));var a=lineThickness/2*Math.sin(u);var f=lineThickness/2*Math.cos(u);var l=[r-a,",",i+f," ",r+a,",",i-f," ",s+a,",",o-f," ",s-a,",",o+f].join("");n.setAttribute("points",l);t.appendChild(n);n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttribute("cx",r);n.setAttribute("cy",i);n.setAttribute("r",lineThickness/2);t.appendChild(n);n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttribute("cx",s);n.setAttribute("cy",o);n.setAttribute("r",lineThickness/2);t.appendChild(n)}defs.appendChild(t);return t}function doBoundingBoxesOverlap(e,t){return e.x<=t.x+t.width&&e.x+e.width>=t.x&&e.y<=t.y+t.height&&e.y+e.height>=t.y}function forwardAllMouseEvents(e,t){e.onmouseenter=function(){t.onmouseenter()};e.onmouseout=function(){t.onmouseout()};e.onmousedown=function(e){t.onmousedown(e)};e.onmouseup=function(e){t.onmouseup(e)};e.ondblclick=function(e){t.ondblclick(e)}}function getAnaglyphedColor(e,t){return"#"+("000000"+(getCyanComponent(e)|getRedComponent(t)).toString(16)).slice(-6)}function getCyanComponent(e){var t=parseInt("0x"+e.slice(1));return t&65535}function getRedComponent(e){var t=parseInt("0x"+e.slice(1));return t&16711680}function correctOverlaps(){if(mode==2){removeOverlaps();addOverlaps()}}function removeOverlaps(){var e;var t=getLinesAndFaces();var n;for(var r=0;r<t.length;r++){e=t[r];removeOverlapsOfItem(e);if(doesElementHaveClass(e,"line")){e.setAttribute("stroke",e.color);e.clone.setAttribute("stroke",e.color)}else if(doesElementHaveClass(e,"face")){e.setAttribute("fill",e.color);e.setAttribute("stroke",e.color);e.under.setAttribute("fill",e.color);e.under.setAttribute("stroke",e.color);e.clone.setAttribute("fill",e.color);e.clone.setAttribute("stroke",e.color);e.clone.under.setAttribute("fill",e.color);e.clone.under.setAttribute("stroke",e.color)}}}function removeOverlapsOfItem(e){var t;for(var n=0;n<e.overlaps.length;n++){t=e.overlaps[n];defs.removeChild(t.itemClip);defs.removeChild(t.cloneClip);shapeGroup.removeChild(t.itemOverlap);shapeGroup.removeChild(t.cloneOverlap);if(t.itemOverlapUnder!=null){shapeGroup.removeChild(t.itemOverlapUnder);shapeGroup.removeChild(t.cloneOverlapUnder)}}e.overlaps=[]}function refresh(){var e;var t=getDots();for(var n=0;n<t.length;n++){e=t[n];moveDot(e,0,0)}}function shiftIn(){var e=getDots();var t;for(var n=0;n<e.length;n++){t=e[n];if(t.isSelected()){t.shift++;t.label.textContent=t.shift}}refresh()}function shiftOut(){var e=getDots();var t;for(var n=0;n<e.length;n++){t=e[n];if(t.isSelected()){t.shift--;t.label.textContent=t.shift}}refresh()}function moveSelectedToBack(){deselectAllDots();var e=getSelected();while(e.length>0){var t=e[0];t.remove();shapeGroup.insertBefore(t,shapeGroup.firstChild);shapeGroup.insertBefore(t.clone,shapeGroup.firstChild);if(t.under!=null){shapeGroup.insertBefore(t.under,shapeGroup.firstChild);shapeGroup.insertBefore(t.clone.under,shapeGroup.firstChild)}t.lowlight();t.deselect();e=getSelected()}}function moveSelectedToFront(){deselectAllDots();var e=getSelected();while(e.length>0){var t=e[0];t.remove();t.add();t.lowlight();t.deselect();e=getSelected()}}function moveSelectedThroughLayers(e){deselectAllDots();var t=getSelected();var n;var r;var i;var s=[];var o;while(t.length>0){n=t[0];s=[];r=getLinesAndFaces();for(var u=0;u<r.length;u++){i=r[u];if(i===n){if(e){if(r.length==u){n.deselect();return}i=r[u+1]}else{if(0==u){n.deselect();return}i=r[u-1];s.push(i)}for(;u<r.length;u++){s.push(r[u])}if(s.length>1){o=s[0];s[0]=s[1];s[1]=o;var a;for(var f=0;f<s.length;f++){a=s[f];a.remove();a.add()}}break}}if(!e){n.lowlight()}n.deselect();t=getSelected()}}function upload(){hideDots();addWatermark();saveSvgAsPng(document.getElementById("svg"),1);hideWatermark();showDots()}function sendToImgur(){setSuccessDisplay("Uploading image...");var e="image="+encodeURIComponent(imageToSend)+"&album=HTD2v8UUS3zApIz";var t=new XMLHttpRequest;t.open("POST","https://api.imgur.com/3/image",true);t.setRequestHeader("Authorization","Client-ID 1070461d2c44f9f");t.setRequestHeader("Content-Type","application/x-www-form-urlencoded");t.onload=function(e){if(t.readyState===4){if(t.status===200){var n=JSON.parse(t.responseText);setSuccessDisplay("Success!",n.data.id)}else{setSuccessDisplay("Upload failed.")}}};t.onerror=function(e){setSuccessDisplay("Upload failed.")};t.send(e)}function setSuccessDisplay(e,t){var n=document.getElementById("uploadResult");if(t!=null&&t!=false){n.innerHTML="<a target='none' href='http://imgur.com/"+t+"'>"+e+"</a>"}else{n.innerHTML=e}}function addWatermark(){var e=document.createElementNS("http://www.w3.org/2000/svg","text");e.setAttribute("id","waterMark");e.setAttribute("x",window.innerWidth-130);e.setAttribute("y",window.innerHeight-10);e.setAttribute("fill","black");e.textContent="StereoSketcher.com";svg.appendChild(e)}function hideWatermark(){var e=document.getElementById("waterMark");svg.removeChild(e)}function addClassToElement(e,t){var n=e.getAttribute("class");if(n==null){e.setAttribute("class","");n==""}if(!doesElementHaveClass(e,t)){e.setAttribute("class",n+" "+t)}}function removeClassFromElement(e,t){var n=new RegExp("(?:^|\\s)"+t+"(?!\\S)","g");e.setAttribute("class",e.getAttribute("class").replace(n,""))}function doesElementHaveClass(e,t){var n=new RegExp("(?:^|\\s)"+t+"(?!\\S)","");var r=e.getAttribute("class");if(r==null||r==""){return false}var i=e.getAttribute("class").match(n);if(i==null){return false}else{return true}}function zoom(e){var t;var n=getDots();var r,i;var s,o;var u,a;var f=e.clientX;var l=e.clientY;var c=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));var h=zoomSpeed;if(c<0){h=1-(zoomSpeed-1)/zoomSpeed}if(c>0){if(zoomLevel>=zoomLimit)return;zoomLevel++}else{if(zoomLevel<=-1*zoomLimit)return;zoomLevel--}IPD*=h;shiftSpeed*=h;lineThickness*=h;showDots();for(var p=0;p<n.length;p++){t=n[p];u=parseFloat(t.getAttribute("cx"));a=parseFloat(t.getAttribute("cy"));r=f-u;i=l-a;s=r-h*r;o=i-h*i;moveDot(t,s,o)}var d;var v=getLines();for(var p=0;p<v.length;p++){d=v[p];var m=parseFloat(d.getAttribute("stroke-width"));d.setAttribute("stroke-width",m*h);d.clone.setAttribute("stroke-width",m*h)}faceActionStrokeWidth*=h;var g;var y=getFaces();for(var p=0;p<y.length;p++){g=y[p];g.under.setAttribute("stroke-width",faceSpaceCorrection+"px");g.clone.under.setAttribute("stroke-width",faceSpaceCorrection+"px")}refresh()}function wasAClick(e){return e.clientX==pressX&&e.clientY==pressY}function keyDown(e){var t=e.keyCode;switch(t){case 46:deletePressed();break;case 68:createLinePressed();break;case 32:toggleDotsVisible();return false;case 83:shiftIn();break;case 65:shiftOut();break;case 70:createFacePressed();break;case 81:moveSelectedToBack();break;case 82:moveSelectedToFront();break;case 69:moveSelectedThroughLayers(true);break;case 87:moveSelectedThroughLayers(false);break;case 67:changeIPD("left");break;case 86:changeIPD("right");break;case 88:thickenLines();break;case 90:thinLines();break;case 49:crossEyeMode();break;case 50:magicEyeMode();break;case 51:redCyanMode();break}}function thickenLines(){var e=getLines();var t;for(var n=0;n<e.length;n++){t=e[n];if(t.isSelected()){t.thicken()}}deselectAll()}function thinLines(){var e=getLines();var t;for(var n=0;n<e.length;n++){t=e[n];if(t.isSelected()){t.thin()}}deselectAll()}function magicEyeMode(){showDots();mode=1;var e=document.getElementById("modeLabel");e.innerHTML="parallel";IPD=originalIPD*-1;refresh()}function redCyanMode(){showDots();mode=2;var e=document.getElementById("modeLabel");e.innerHTML="red/cyan";IPD=0;refresh()}function crossEyeMode(){showDots();mode=0;var e=document.getElementById("modeLabel");e.innerHTML="cross";IPD=originalIPD;refresh()}function changeIPD(e){if(e=="right"){IPD++}else{IPD--}refresh()}function toggleDotsVisible(){if(dotsVisible){hideDots()}else{showDots()}}function showDots(){var e=document.getElementById("modeLabel");e.setAttribute("visibility","visible");var t=getDots();var n;for(var r=0;r<t.length;r++){n=t[r];n.setAttribute("visibility","visible");n.label.setAttribute("visibility","visible")}dotsVisible=true;removeOverlaps()}function hideDots(){var e=document.getElementById("modeLabel");e.setAttribute("visibility","hidden");var t=getDots();var n;for(var r=0;r<t.length;r++){n=t[r];n.setAttribute("visibility","hidden");n.label.setAttribute("visibility","hidden")}dotsVisible=false;correctOverlaps()}function getDots(){return dotGroup.getElementsByClassName("dot")}function getLines(){return shapeGroup.getElementsByClassName("line")}function getLinesAndFaces(){var e;var t=shapeGroup.children;var n=[];for(var r=0;r<t.length;r++){e=t[r];if(doesElementHaveClass(e,"line")||doesElementHaveClass(e,"face")){n.push(e)}}return n}function getFaces(){return shapeGroup.getElementsByClassName("face")}function getSelected(){return svg.getElementsByClassName("selected")}function getLabels(){return labelGroup.getElementsByClassName("label")}function createLinePressed(){var e=0;var t;var n;var r=getDots();for(var i=0;i<r.length;i++){if(r[i].isSelected()){e++;if(t==null){t=r[i];continue}if(n==null){n=r[i];continue}if(e==3){return}}}if(e!=2){return}var s=getLines();var o;for(var u=0;u<s.length;u++){o=s[u];if((o.dot1==t||o.dot2==t)&&(o.dot1==n||o.dot2==n)){return}}shapeFactory.createLine(t,n)}function createFacePressed(){var e=0;var t;var n;var r;var i=getDots();for(var s=0;s<i.length;s++){if(i[s].isSelected()){e++;if(t==null){t=i[s];continue}if(n==null){n=i[s];continue}if(r==null){r=i[s];continue}if(e==4){return}}}if(e!=3){return}var o=getFaces();var u;for(var a=0;a<o.length;a++){u=o[a];if((t==u.dot1||t==u.dot2||t==u.dot3)&&(n==u.dot1||n==u.dot2||n==u.dot3)&&(r==u.dot1||r==u.dot2||r==u.dot3)){return}}shapeFactory.createFace(t,n,r)}function deletePressed(){var e;var t=getDots();for(var n=t.length-1;n>=0;n--){e=t[n];if(e.isSelected()){labelGroup.removeChild(e.label);dotGroup.removeChild(e)}}var r;var i=getLines();for(var n=i.length-1;n>=0;n--){r=i[n];if(r.isSelected()||r.dot1.isSelected()||r.dot2.isSelected()){r.remove()}}var s;var o=getFaces();for(var n=o.length-1;n>=0;n--){s=o[n];if(s.isSelected()||s.dot1.isSelected()||s.dot2.isSelected()||s.dot3.isSelected()){s.remove()}}}function preventDefault(e){e.preventDefault?e.preventDefault():e.returnValue=false}(function(){function n(e){var t=document.querySelectorAll("svg image");var n=t.length;if(n==0){e()}for(var r=0;r<t.length;r++){(function(t){if(t.getAttribute("xlink:href")){var r=t.getAttribute("xlink:href").value;if(/^http/.test(r)&&!(new RegExp("^"+window.location.host)).test(r)){throw new Error("Cannot render embedded images linking to external hosts.")}}var i=document.createElement("canvas");var s=i.getContext("2d");var o=new Image;o.src=t.getAttribute("xlink:href");o.onload=function(){i.width=o.width;i.height=o.height;s.drawImage(o,0,0);t.setAttribute("xlink:href",i.toDataURL("image/png"));n--;if(n==0){e()}}})(t[r])}}function r(e){var t="";var n=document.styleSheets;for(var r=0;r<n.length;r++){var i=n[r].cssRules;if(i!=null){for(var s=0;s<i.length;s++){var o=i[s];if(typeof o.style!="undefined"){t+=o.selectorText+" { "+o.style.cssText+" }\n"}}}}var u=document.createElement("style");u.setAttribute("type","text/css");u.innerHTML="<![CDATA[\n"+t+"\n]]>";var a=document.createElement("defs");a.appendChild(u);return a}var e=typeof exports!="undefined"&&exports||this;var t='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">';e.svgAsDataUri=function(i,s,o){s=s||1;n(function(){var n=document.createElement("div");var u=i.cloneNode(true);var a=parseInt(u.getAttribute("width")||u.style.width||e.getComputedStyle(i).getPropertyValue("width"));var f=parseInt(u.getAttribute("height")||u.style.height||e.getComputedStyle(i).getPropertyValue("height"));var l="http://www.w3.org/2000/xmlns/";u.setAttribute("version","1.1");u.setAttributeNS(l,"xmlns","http://www.w3.org/2000/svg");u.setAttributeNS(l,"xmlns:xlink","http://www.w3.org/1999/xlink");u.setAttribute("width",a*s);u.setAttribute("height",f*s);u.setAttribute("viewBox","0 0 "+a+" "+f);n.appendChild(u);u.insertBefore(r(u),u.firstChild);var c=t+n.innerHTML;var h="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(c)));if(o){o(h)}})};e.saveSvgAsPng=function(t,n){e.svgAsDataUri(t,n,function(e){var t=new Image;t.src=e;t.onload=function(){var e=document.createElement("canvas");e.width=t.width;e.height=t.height;var n=e.getContext("2d");n.drawImage(t,0,0);imageToSend=e.toDataURL("image/png").slice(22);sendToImgur()}})}})();"use strict";"use strict";"use strict";var selectangle;"use strict";"use strict";"use strict";"use strict";var shiftSpeed=.5;var originalIPD=250;var IPD=originalIPD;"use strict";var imageToSend;"use strict";"use strict";var zoomLevel=0;var zoomSpeed=1.5;var zoomLimit=15;"use strict";var svg,dotGroup,labelGroup,shapeGroup,defs;var dotsVisible=true;var mode=0;var pressX,pressY;var prevX,prevY;window.onload=function(){svg=document.getElementById("svg");dotGroup=document.getElementById("dots");labelGroup=document.getElementById("labels");shapeGroup=document.getElementById("shapes");defs=document.getElementById("defs");svg.onmousedown=function(e){showDots();pressX=e.clientX;pressY=e.clientY;prevX=pressX;prevY=pressY;if(e.button==0){svg.onmousemove=function(e){preventDefault(e);changeSelectangle(e)}}if(e.button==2){var t=getDots();svg.onmousemove=function(e){preventDefault(e);dragDots(e,t)}}};svg.onmouseup=function(e){if(wasAClick(e)){if(e.button==0){shapeFactory.createCircle(e)}if(e.button==2){deselectAll()}}else if(e.button==0){if(selectangle!=null){var t=parseFloat(selectangle.getAttribute("width"))+parseFloat(selectangle.getAttribute("x"));var n=parseFloat(selectangle.getAttribute("x"));var r=parseFloat(selectangle.getAttribute("height"))+parseFloat(selectangle.getAttribute("y"));var i=parseFloat(selectangle.getAttribute("y"));var s=getDots();if(!e.shiftKey){deselectAll()}for(var o=0;o<s.length;o++){var u=s[o];var a=parseFloat(u.getAttribute("cx"));var f=parseFloat(u.getAttribute("cy"));if(a<t&&a>n){if(f<r&&f>i){u.select()}}}svg.removeChild(selectangle);selectangle=null}}svg.onmousemove=null};svg.addEventListener("mousewheel",zoom,false);svg.addEventListener("DOMMouseScroll",zoom,false);crossEyeMode()};document.addEventListener("keydown",keyDown,false);"use strict";var faceSpaceCorrection="0.5px";var faceActionStrokeWidth=3;var labelX=-15;var labelY=-7;var lineThickness=2;var thickenRate=1.2;var thinRate=1-(thickenRate-1)/thickenRate;var dotRadius=7;var faceStartColor="#777777";var shapeFactory={createCircle:function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","circle");t.setAttribute("cx",e.clientX);t.setAttribute("cy",e.clientY);t.setAttribute("r",dotRadius);t.setAttribute("stroke","black");t.setAttribute("stroke-width",1);t.setAttribute("fill","yellow");t.setAttribute("fill-opacity",0);t.setAttribute("class","dot");addClassToElement(t,"highlit");this.attachCommonHandlers(t);t.ondblclick=function(e){e.stopPropagation();if(wasAClick(e)){selectAllContiguous(this,e)}};t.lines=[];t.shift=0;var n=document.createElementNS("http://www.w3.org/2000/svg","text");n.setAttribute("x",parseFloat(t.getAttribute("cx"))+labelX);n.setAttribute("y",parseFloat(t.getAttribute("cy"))+labelY);n.setAttribute("fill","black");n.setAttribute("class","label");n.textContent="0";t.label=n;t.faces=[];labelGroup.appendChild(n);dotGroup.appendChild(t);t.select=function(){this.setAttribute("fill-opacity",.5);addClassToElement(this,"selected")};t.deselect=function(){this.setAttribute("fill-opacity",0);removeClassFromElement(this,"selected");if(doesElementHaveClass(this,"highlit")){this.highlight()}};t.highlight=function(){this.setAttribute("stroke","green");this.label.setAttribute("fill","green");addClassToElement(this,"highlit")};t.lowlight=function(){this.setAttribute("stroke","black");this.label.setAttribute("fill","black");removeClassFromElement(this,"highlit")};if(e.shiftKey){t.select()}},attachCommonHandlers:function(e){e.onmouseenter=function(){this.highlight()};e.onmouseout=function(){this.lowlight()};e.isSelected=function(){return doesElementHaveClass(this,"selected")};e.toggleSelect=function(){if(this.isSelected()){this.deselect()}else{this.select()}};e.onmousedown=function(e){preventDefault(e);if(e.button==0){pressX=e.clientX;pressY=e.clientY;prevX=pressX;prevY=pressY;if(doesElementHaveClass(this,"dot")){if(this.isSelected()){e.stopPropagation();var t;var n=getDots();var r=[];for(var i=0;i<n.length;i++){t=n[i];if(t.isSelected()){r.push(t)}}this.onmousemove=function(e){e.stopPropagation();dragDots(e,r)};svg.onmousemove=function(e){e.stopPropagation();dragDots(e,r)}}}}};e.onmouseup=function(e){if(e.button==0){e.stopPropagation();if(wasAClick(e)){if(e.shiftKey){this.toggleSelect()}else{var t;if(this.isSelected()){t=true}deselectAll();if(t){this.deselect()}else{this.select()}}}svg.onmousemove=null;this.onmousemove=null;this.onmouseout=function(){this.lowlight()}}}},createLine:function(e,t){var n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1",e.getAttribute("cx"));n.setAttribute("y1",e.getAttribute("cy"));n.setAttribute("x2",t.getAttribute("cx"));n.setAttribute("y2",t.getAttribute("cy"));n.color="black";n.setAttribute("stroke","black");n.setAttribute("stroke-width",lineThickness);n.setAttribute("class","line");n.dot1=e;n.dot2=t;e.lines.push(n);t.lines.push(n);this.attachCommonHandlers(n);e.deselect();t.deselect();n.ondblclick=function(e){e.stopPropagation();selectDotsOfLine(this,e)};n.setAttribute("stroke-linecap","round");this.createCloneLine(n);shapeGroup.appendChild(n);n.overlaps=[];n.select=function(){this.setAttribute("stroke","yellow");addClassToElement(this,"selected")};n.deselect=function(){this.setAttribute("stroke",this.color);removeClassFromElement(this,"selected");if(doesElementHaveClass(this,"highlit")){this.highlight()}};n.highlight=function(){this.setAttribute("stroke","green");addClassToElement(this,"highlit")};n.lowlight=function(){removeClassFromElement(this,"highlit");if(this.isSelected()){this.setAttribute("stroke","yellow")}else{this.setAttribute("stroke",this.color)}};n.thicken=function(){var e=parseFloat(this.getAttribute("stroke-width"));this.setAttribute("stroke-width",e*thickenRate);this.clone.setAttribute("stroke-width",e*thickenRate)};n.thin=function(){var e=parseFloat(this.getAttribute("stroke-width"));this.setAttribute("stroke-width",e*thinRate);this.clone.setAttribute("stroke-width",e*thinRate)};n.add=function(){shapeGroup.appendChild(this.clone);shapeGroup.appendChild(this)};n.remove=function(){shapeGroup.removeChild(this);shapeGroup.removeChild(this.clone);removeOverlapsOfItem(this)}},createCloneLine:function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","line");e.clone=t;t.setAttribute("x1",parseFloat(e.dot1.getAttribute("cx"))+IPD+e.dot1.shift*shiftSpeed);t.setAttribute("y1",e.dot1.getAttribute("cy"));t.setAttribute("x2",parseFloat(e.dot2.getAttribute("cx"))+IPD+e.dot2.shift*shiftSpeed);t.setAttribute("y2",e.dot2.getAttribute("cy"));t.setAttribute("stroke","black");t.setAttribute("stroke-width",lineThickness);t.setAttribute("class","cloneLine");t.setAttribute("stroke-linecap","round");shapeGroup.appendChild(t)},createFace:function(e,t,n){var r=document.createElementNS("http://www.w3.org/2000/svg","polygon");var i=document.createElementNS("http://www.w3.org/2000/svg","polygon");var s="";e.faces.push(r);t.faces.push(r);n.faces.push(r);s+=e.getAttribute("cx")+","+e.getAttribute("cy")+" ";s+=t.getAttribute("cx")+","+t.getAttribute("cy")+" ";s+=n.getAttribute("cx")+","+n.getAttribute("cy")+" ";e.deselect();t.deselect();n.deselect();r.dot1=e;r.dot2=t;r.dot3=n;r.setAttribute("points",s);i.setAttribute("points",s);r.under=i;r.setAttribute("fill",faceStartColor);r.setAttribute("class","face");r.color=faceStartColor;i.setAttribute("fill",faceStartColor);i.setAttribute("stroke",faceStartColor);i.setAttribute("stroke-width",faceSpaceCorrection);i.setAttribute("stroke-opacity",1);i.setAttribute("class","faceUnder");this.attachCommonHandlers(r);r.ondblclick=function(e){e.stopPropagation();selectDotsOfFace(this,e)};this.createCloneFace(r);shapeGroup.appendChild(i);shapeGroup.appendChild(r);r.overlaps=[];r.select=function(){this.setAttribute("stroke-width",faceActionStrokeWidth);this.setAttribute("stroke","yellow");addClassToElement(this,"selected")};r.deselect=function(){this.setAttribute("stroke-width",0);removeClassFromElement(this,"selected");if(doesElementHaveClass(this,"highlit")){this.highlight()}};r.highlight=function(){this.setAttribute("stroke","green");this.setAttribute("stroke-width",faceActionStrokeWidth);addClassToElement(this,"highlit")};r.lowlight=function(){removeClassFromElement(this,"highlit");if(this.isSelected()){this.setAttribute("stroke","yellow")}else{this.setAttribute("stroke-width",0)}};r.add=function(){shapeGroup.appendChild(this.clone.under);shapeGroup.appendChild(this.clone);shapeGroup.appendChild(this.under);shapeGroup.appendChild(this)};r.remove=function(){shapeGroup.removeChild(this.clone.under);shapeGroup.removeChild(this.clone);shapeGroup.removeChild(this.under);shapeGroup.removeChild(this);removeOverlapsOfItem(this)}},createCloneFace:function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","polygon");var n=document.createElementNS("http://www.w3.org/2000/svg","polygon");e.clone=t;var r="";r+=parseFloat(e.dot1.getAttribute("cx"))+IPD+e.dot1.shift*shiftSpeed+","+e.dot1.getAttribute("cy")+" ";r+=parseFloat(e.dot2.getAttribute("cx"))+IPD+e.dot2.shift*shiftSpeed+","+e.dot2.getAttribute("cy")+" ";r+=parseFloat(e.dot3.getAttribute("cx"))+IPD+e.dot3.shift*shiftSpeed+","+e.dot3.getAttribute("cy")+" ";t.setAttribute("points",r);n.setAttribute("points",r);t.under=n;t.setAttribute("class","cloneFace");t.setAttribute("stroke-width",0);t.setAttribute("fill",faceStartColor);n.setAttribute("fill",faceStartColor);n.setAttribute("stroke",faceStartColor);n.setAttribute("stroke-width",faceSpaceCorrection);n.setAttribute("stroke-opacity",1);n.setAttribute("class","cloneUnder");shapeGroup.appendChild(n);shapeGroup.appendChild(t)}};var jscolor={dir:"",bindClass:"color",binding:true,preloading:true,install:function(){jscolor.addEvent(window,"load",jscolor.init)},init:function(){if(jscolor.binding){jscolor.bind()}if(jscolor.preloading){jscolor.preload()}},getDir:function(){if(!jscolor.dir){var e=jscolor.detectDir();jscolor.dir=e!==false?e:"jscolor/"}return jscolor.dir},detectDir:function(){var e=location.href;var t=document.getElementsByTagName("base");for(var n=0;n<t.length;n+=1){if(t[n].href){e=t[n].href}}var t=document.getElementsByTagName("script");for(var n=0;n<t.length;n+=1){if(t[n].src&&/(^|\/)jscolor\.js([?#].*)?$/i.test(t[n].src)){var r=new jscolor.URI(t[n].src);var i=r.toAbsolute(e);i.path=i.path.replace(/[^\/]+$/,"");i.query=null;i.fragment=null;return i.toString()}}return false},bind:function(){var e=new RegExp("(^|\\s)("+jscolor.bindClass+")(\\s*(\\{[^}]*\\})|\\s|$)","i");var t=document.getElementsByTagName("input");for(var n=0;n<t.length;n+=1){var r;if(!t[n].color&&t[n].className&&(r=t[n].className.match(e))){var i={};if(r[4]){try{i=(new Function("return ("+r[4]+")"))()}catch(s){}}t[n].color=new jscolor.color(t[n],i)}}},preload:function(){for(var e in jscolor.imgRequire){if(jscolor.imgRequire.hasOwnProperty(e)){jscolor.loadImage(e)}}},images:{pad:[181,101],sld:[16,101],cross:[15,15],arrow:[7,11]},imgRequire:{},imgLoaded:{},requireImage:function(e){jscolor.imgRequire[e]=true},loadImage:function(e){if(!jscolor.imgLoaded[e]){jscolor.imgLoaded[e]=new Image;jscolor.imgLoaded[e].src=jscolor.getDir()+e}},fetchElement:function(e){return typeof e==="string"?document.getElementById(e):e},addEvent:function(e,t,n){if(e.addEventListener){e.addEventListener(t,n,false)}else if(e.attachEvent){e.attachEvent("on"+t,n)}},fireEvent:function(e,t){if(!e){return}if(document.createEvent){var n=document.createEvent("HTMLEvents");n.initEvent(t,true,true);e.dispatchEvent(n)}else if(document.createEventObject){var n=document.createEventObject();e.fireEvent("on"+t,n)}else if(e["on"+t]){e["on"+t]()}},getElementPos:function(e){var t=e,n=e;var r=0,i=0;if(t.offsetParent){do{r+=t.offsetLeft;i+=t.offsetTop}while(t=t.offsetParent)}while((n=n.parentNode)&&n.nodeName.toUpperCase()!=="BODY"){r-=n.scrollLeft;i-=n.scrollTop}return[r,i]},getElementSize:function(e){return[e.offsetWidth,e.offsetHeight]},getRelMousePos:function(e){var t=0,n=0;if(!e){e=window.event}if(typeof e.offsetX==="number"){t=e.offsetX;n=e.offsetY}else if(typeof e.layerX==="number"){t=e.layerX;n=e.layerY}return{x:t,y:n}},getViewPos:function(){if(typeof window.pageYOffset==="number"){return[window.pageXOffset,window.pageYOffset]}else if(document.body&&(document.body.scrollLeft||document.body.scrollTop)){return[document.body.scrollLeft,document.body.scrollTop]}else if(document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)){return[document.documentElement.scrollLeft,document.documentElement.scrollTop]}else{return[0,0]}},getViewSize:function(){if(typeof window.innerWidth==="number"){return[window.innerWidth,window.innerHeight]}else if(document.body&&(document.body.clientWidth||document.body.clientHeight)){return[document.body.clientWidth,document.body.clientHeight]}else if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)){return[document.documentElement.clientWidth,document.documentElement.clientHeight]}else{return[0,0]}},URI:function(e){function t(e){var t="";while(e){if(e.substr(0,3)==="../"||e.substr(0,2)==="./"){e=e.replace(/^\.+/,"").substr(1)}else if(e.substr(0,3)==="/./"||e==="/."){e="/"+e.substr(3)}else if(e.substr(0,4)==="/../"||e==="/.."){e="/"+e.substr(4);t=t.replace(/\/?[^\/]*$/,"")}else if(e==="."||e===".."){e=""}else{var n=e.match(/^\/?[^\/]*/)[0];e=e.substr(n.length);t=t+n}}return t}this.scheme=null;this.authority=null;this.path="";this.query=null;this.fragment=null;this.parse=function(e){var t=e.match(/^(([A-Za-z][0-9A-Za-z+.-]*)(:))?((\/\/)([^\/?#]*))?([^?#]*)((\?)([^#]*))?((#)(.*))?/);this.scheme=t[3]?t[2]:null;this.authority=t[5]?t[6]:null;this.path=t[7];this.query=t[9]?t[10]:null;this.fragment=t[12]?t[13]:null;return this};this.toString=function(){var e="";if(this.scheme!==null){e=e+this.scheme+":"}if(this.authority!==null){e=e+"//"+this.authority}if(this.path!==null){e=e+this.path}if(this.query!==null){e=e+"?"+this.query}if(this.fragment!==null){e=e+"#"+this.fragment}return e};this.toAbsolute=function(e){var e=new jscolor.URI(e);var n=this;var r=new jscolor.URI;if(e.scheme===null){return false}if(n.scheme!==null&&n.scheme.toLowerCase()===e.scheme.toLowerCase()){n.scheme=null}if(n.scheme!==null){r.scheme=n.scheme;r.authority=n.authority;r.path=t(n.path);r.query=n.query}else{if(n.authority!==null){r.authority=n.authority;r.path=t(n.path);r.query=n.query}else{if(n.path===""){r.path=e.path;if(n.query!==null){r.query=n.query}else{r.query=e.query}}else{if(n.path.substr(0,1)==="/"){r.path=t(n.path)}else{if(e.authority!==null&&e.path===""){r.path="/"+n.path}else{r.path=e.path.replace(/[^\/]+$/,"")+n.path}r.path=t(r.path)}r.query=n.query}r.authority=e.authority}r.scheme=e.scheme}r.fragment=n.fragment;return r};if(e){this.parse(e)}},color:function(e,t){function r(e,t,n){var r=Math.min(Math.min(e,t),n);var i=Math.max(Math.max(e,t),n);var s=i-r;if(s===0){return[null,0,i]}var o=e===r?3+(n-t)/s:t===r?5+(e-n)/s:1+(t-e)/s;return[o===6?0:o,s/i,i]}function i(e,t,n){if(e===null){return[n,n,n]}var r=Math.floor(e);var i=r%2?e-r:1-(e-r);var s=n*(1-t);var o=n*(1-t*i);switch(r){case 6:case 0:return[n,o,s];case 1:return[o,n,s];case 2:return[s,n,o];case 3:return[s,o,n];case 4:return[o,s,n];case 5:return[n,s,o]}}function s(){delete jscolor.picker.owner;document.getElementsByTagName("body")[0].removeChild(jscolor.picker.boxB)}function o(e,t){function h(){var e=m.pickerInsetColor.split(/\s+/);var t=e.length<2?e[0]:e[1]+" "+e[0]+" "+e[0]+" "+e[1];s.btn.style.borderColor=t}if(!jscolor.picker){jscolor.picker={box:document.createElement("div"),boxB:document.createElement("div"),pad:document.createElement("div"),padB:document.createElement("div"),padM:document.createElement("div"),sld:document.createElement("div"),sldB:document.createElement("div"),sldM:document.createElement("div"),btn:document.createElement("div"),btnS:document.createElement("span"),btnT:document.createTextNode(m.pickerCloseText)};for(var n=0,r=4;n<jscolor.images.sld[1];n+=r){var i=document.createElement("div");i.style.height=r+"px";i.style.fontSize="1px";i.style.lineHeight="0";jscolor.picker.sld.appendChild(i)}jscolor.picker.sldB.appendChild(jscolor.picker.sld);jscolor.picker.box.appendChild(jscolor.picker.sldB);jscolor.picker.box.appendChild(jscolor.picker.sldM);jscolor.picker.padB.appendChild(jscolor.picker.pad);jscolor.picker.box.appendChild(jscolor.picker.padB);jscolor.picker.box.appendChild(jscolor.picker.padM);jscolor.picker.btnS.appendChild(jscolor.picker.btnT);jscolor.picker.btn.appendChild(jscolor.picker.btnS);jscolor.picker.box.appendChild(jscolor.picker.btn);jscolor.picker.boxB.appendChild(jscolor.picker.box)}var s=jscolor.picker;s.box.onmouseup=s.box.onmouseout=function(){showColorPicker()};s.box.onmousedown=function(){y=true};s.box.onmousemove=function(e){if(E||S){E&&p(e);S&&d(e);if(document.selection){document.selection.empty()}else if(window.getSelection){window.getSelection().removeAllRanges()}v()}s.box.onmouseenter=function(){showColorPicker()};s.box.onmouseleave=function(){hideColorPicker()}};if("ontouchstart"in window){var o=function(e){var t={offsetX:e.touches[0].pageX-x.X,offsetY:e.touches[0].pageY-x.Y};if(E||S){E&&p(t);S&&d(t);v()}e.stopPropagation();e.preventDefault()};s.box.removeEventListener("touchmove",o,false);s.box.addEventListener("touchmove",o,false)}s.padM.onmouseup=s.padM.onmouseout=function(){if(E){E=false;jscolor.fireEvent(b,"change")}};s.padM.onmousedown=function(e){switch(g){case 0:if(m.hsv[2]===0){m.fromHSV(null,null,1)}break;case 1:if(m.hsv[1]===0){m.fromHSV(null,1,null)}break}S=false;E=true;p(e);v()};if("ontouchstart"in window){s.padM.addEventListener("touchstart",function(e){x={X:e.target.offsetParent.offsetLeft,Y:e.target.offsetParent.offsetTop};this.onmousedown({offsetX:e.touches[0].pageX-x.X,offsetY:e.touches[0].pageY-x.Y})})}s.sldM.onmouseup=s.sldM.onmouseout=function(){if(S){S=false;jscolor.fireEvent(b,"change")}};s.sldM.onmousedown=function(e){E=false;S=true;d(e);v()};if("ontouchstart"in window){s.sldM.addEventListener("touchstart",function(e){x={X:e.target.offsetParent.offsetLeft,Y:e.target.offsetParent.offsetTop};this.onmousedown({offsetX:e.touches[0].pageX-x.X,offsetY:e.touches[0].pageY-x.Y})})}var l=u(m);s.box.style.width=l[0]+"px";s.box.style.height=l[1]+"px";s.boxB.style.position="absolute";s.boxB.style.clear="both";s.boxB.style.left=e+"px";s.boxB.style.top=t+"px";s.boxB.style.zIndex=m.pickerZIndex;s.boxB.style.border=m.pickerBorder+"px solid";s.boxB.style.borderColor=m.pickerBorderColor;s.boxB.style.background=m.pickerFaceColor;s.pad.style.width=jscolor.images.pad[0]+"px";s.pad.style.height=jscolor.images.pad[1]+"px";s.padB.style.position="absolute";s.padB.style.left=m.pickerFace+"px";s.padB.style.top=m.pickerFace+"px";s.padB.style.border=m.pickerInset+"px solid";s.padB.style.borderColor=m.pickerInsetColor;s.padM.style.position="absolute";s.padM.style.left="0";s.padM.style.top="0";s.padM.style.width=m.pickerFace+2*m.pickerInset+jscolor.images.pad[0]+jscolor.images.arrow[0]+"px";s.padM.style.height=s.box.style.height;s.padM.style.cursor="crosshair";s.sld.style.overflow="hidden";s.sld.style.width=jscolor.images.sld[0]+"px";s.sld.style.height=jscolor.images.sld[1]+"px";s.sldB.style.display=m.slider?"block":"none";s.sldB.style.position="absolute";s.sldB.style.right=m.pickerFace+"px";s.sldB.style.top=m.pickerFace+"px";s.sldB.style.border=m.pickerInset+"px solid";s.sldB.style.borderColor=m.pickerInsetColor;s.sldM.style.display=m.slider?"block":"none";s.sldM.style.position="absolute";s.sldM.style.right="0";s.sldM.style.top="0";s.sldM.style.width=jscolor.images.sld[0]+jscolor.images.arrow[0]+m.pickerFace+2*m.pickerInset+"px";s.sldM.style.height=s.box.style.height;try{s.sldM.style.cursor="pointer"}catch(c){s.sldM.style.cursor="hand"}s.btn.style.display=m.pickerClosable?"block":"none";s.btn.style.position="absolute";s.btn.style.left=m.pickerFace+"px";s.btn.style.bottom=m.pickerFace+"px";s.btn.style.padding="0 15px";s.btn.style.height="18px";s.btn.style.border=m.pickerInset+"px solid";h();s.btn.style.color=m.pickerButtonColor;s.btn.style.font="12px sans-serif";s.btn.style.textAlign="center";try{s.btn.style.cursor="pointer"}catch(c){s.btn.style.cursor="hand"}s.btn.onmousedown=function(){m.hidePicker()};s.btnS.style.lineHeight=s.btn.style.height;switch(g){case 0:var w="hs.png";break;case 1:var w="hv.png";break}s.padM.style.backgroundImage="url('"+jscolor.getDir()+"cross.gif')";s.padM.style.backgroundRepeat="no-repeat";s.sldM.style.backgroundImage="url('"+jscolor.getDir()+"arrow.gif')";s.sldM.style.backgroundRepeat="no-repeat";s.pad.style.backgroundImage="url('"+jscolor.getDir()+w+"')";s.pad.style.backgroundRepeat="no-repeat";s.pad.style.backgroundPosition="0 0";a();f();jscolor.picker.owner=m;document.getElementsByTagName("body")[0].appendChild(s.boxB)}function u(e){var t=[2*e.pickerInset+2*e.pickerFace+jscolor.images.pad[0]+(e.slider?2*e.pickerInset+2*jscolor.images.arrow[0]+jscolor.images.sld[0]:0),e.pickerClosable?4*e.pickerInset+3*e.pickerFace+jscolor.images.pad[1]+e.pickerButtonHeight:2*e.pickerInset+2*e.pickerFace+jscolor.images.pad[1]];return t}function a(){switch(g){case 0:var e=1;break;case 1:var e=2;break}var t=Math.round(m.hsv[0]/6*(jscolor.images.pad[0]-1));var n=Math.round((1-m.hsv[e])*(jscolor.images.pad[1]-1));jscolor.picker.padM.style.backgroundPosition=m.pickerFace+m.pickerInset+t-Math.floor(jscolor.images.cross[0]/2)+"px "+(m.pickerFace+m.pickerInset+n-Math.floor(jscolor.images.cross[1]/2))+"px";var r=jscolor.picker.sld.childNodes;switch(g){case 0:var s=i(m.hsv[0],m.hsv[1],1);for(var o=0;o<r.length;o+=1){r[o].style.backgroundColor="rgb("+s[0]*(1-o/r.length)*100+"%,"+s[1]*(1-o/r.length)*100+"%,"+s[2]*(1-o/r.length)*100+"%)"}break;case 1:var s,u,a=[m.hsv[2],0,0];var o=Math.floor(m.hsv[0]);var f=o%2?m.hsv[0]-o:1-(m.hsv[0]-o);switch(o){case 6:case 0:s=[0,1,2];break;case 1:s=[1,0,2];break;case 2:s=[2,0,1];break;case 3:s=[2,1,0];break;case 4:s=[1,2,0];break;case 5:s=[0,2,1];break}for(var o=0;o<r.length;o+=1){u=1-1/(r.length-1)*o;a[1]=a[0]*(1-u*f);a[2]=a[0]*(1-u);r[o].style.backgroundColor="rgb("+a[s[0]]*100+"%,"+a[s[1]]*100+"%,"+a[s[2]]*100+"%)"}break}}function f(){switch(g){case 0:var e=2;break;case 1:var e=1;break}var t=Math.round((1-m.hsv[e])*(jscolor.images.sld[1]-1));jscolor.picker.sldM.style.backgroundPosition="0 "+(m.pickerFace+m.pickerInset+t-Math.floor(jscolor.images.arrow[1]/2))+"px"}function l(){return jscolor.picker&&jscolor.picker.owner===m}function c(){if(b===e){m.importColor()}if(m.pickerOnfocus){m.hidePicker()}}function h(){if(b!==e){m.importColor()}}function p(e){var t=jscolor.getRelMousePos(e);var n=t.x-m.pickerFace-m.pickerInset;var r=t.y-m.pickerFace-m.pickerInset;switch(g){case 0:m.fromHSV(n*(6/(jscolor.images.pad[0]-1)),1-r/(jscolor.images.pad[1]-1),null,k);break;case 1:m.fromHSV(n*(6/(jscolor.images.pad[0]-1)),null,1-r/(jscolor.images.pad[1]-1),k);break}}function d(e){var t=jscolor.getRelMousePos(e);var n=t.y-m.pickerFace-m.pickerInset;switch(g){case 0:m.fromHSV(null,null,1-n/(jscolor.images.sld[1]-1),C);break;case 1:m.fromHSV(null,1-n/(jscolor.images.sld[1]-1),null,C);break}}function v(){if(m.onImmediateChange){var e;if(typeof m.onImmediateChange==="string"){e=new Function(m.onImmediateChange)}else{e=m.onImmediateChange}e.call(m)}}this.required=true;this.adjust=true;this.hash=false;this.caps=true;this.slider=true;this.valueElement=e;this.styleElement=e;this.onImmediateChange=null;this.hsv=[0,0,1];this.rgb=[1,1,1];this.minH=0;this.maxH=6;this.minS=0;this.maxS=1;this.minV=0;this.maxV=1;this.pickerOnfocus=true;this.pickerMode="HSV";this.pickerPosition="bottom";this.pickerSmartPosition=true;this.pickerButtonHeight=20;this.pickerClosable=false;this.pickerCloseText="Close";this.pickerButtonColor="ButtonText";this.pickerFace=10;this.pickerFaceColor="ThreeDFace";this.pickerBorder=1;this.pickerBorderColor="ThreeDHighlight ThreeDShadow ThreeDShadow ThreeDHighlight";this.pickerInset=1;this.pickerInsetColor="ThreeDShadow ThreeDHighlight ThreeDHighlight ThreeDShadow";this.pickerZIndex=1e4;for(var n in t){if(t.hasOwnProperty(n)){this[n]=t[n]}}this.hidePicker=function(){if(l()){s()}};this.showPicker=function(){if(!l()){var t=jscolor.getElementPos(e);var n=jscolor.getElementSize(e);var r=jscolor.getViewPos();var i=jscolor.getViewSize();var s=u(this);var a,f,c;switch(this.pickerPosition.toLowerCase()){case"left":a=1;f=0;c=-1;break;case"right":a=1;f=0;c=1;break;case"top":a=0;f=1;c=-1;break;default:a=0;f=1;c=1;break}var h=(n[f]+s[f])/2;if(!this.pickerSmartPosition){var p=[t[a],t[f]+n[f]-h+h*c]}else{var p=[-r[a]+t[a]+s[a]>i[a]?-r[a]+t[a]+n[a]/2>i[a]/2&&t[a]+n[a]-s[a]>=0?t[a]+n[a]-s[a]:t[a]:t[a],-r[f]+t[f]+n[f]+s[f]-h+h*c>i[f]?-r[f]+t[f]+n[f]/2>i[f]/2&&t[f]+n[f]-h-h*c>=0?t[f]+n[f]-h-h*c:t[f]+n[f]-h+h*c:t[f]+n[f]-h+h*c>=0?t[f]+n[f]-h+h*c:t[f]+n[f]-h-h*c]}o(p[a],p[f])}};this.importColor=function(){if(!b){this.exportColor()}else{if(!this.adjust){if(!this.fromString(b.value,T)){w.style.backgroundImage=w.jscStyle.backgroundImage;w.style.backgroundColor=w.jscStyle.backgroundColor;w.style.color=w.jscStyle.color;this.exportColor(T|N)}}else if(!this.required&&/^\s*$/.test(b.value)){b.value="";w.style.backgroundImage=w.jscStyle.backgroundImage;w.style.backgroundColor=w.jscStyle.backgroundColor;w.style.color=w.jscStyle.color;this.exportColor(T|N)}else if(this.fromString(b.value)){}else{this.exportColor()}}};this.exportColor=function(e){if(!(e&T)&&b){var t=this.toString();if(this.caps){t=t.toUpperCase()}if(this.hash){t="#"+t}b.value=t}if(!(e&N)&&w){w.style.backgroundImage="none";w.style.backgroundColor="#"+this.toString();w.style.color=.213*this.rgb[0]+.715*this.rgb[1]+.072*this.rgb[2]<.5?"#FFF":"#000"}if(!(e&C)&&l()){a()}if(!(e&k)&&l()){f()}};this.fromHSV=function(e,t,n,r){if(e!==null){e=Math.max(0,this.minH,Math.min(6,this.maxH,e))}if(t!==null){t=Math.max(0,this.minS,Math.min(1,this.maxS,t))}if(n!==null){n=Math.max(0,this.minV,Math.min(1,this.maxV,n))}this.rgb=i(e===null?this.hsv[0]:this.hsv[0]=e,t===null?this.hsv[1]:this.hsv[1]=t,n===null?this.hsv[2]:this.hsv[2]=n);this.exportColor(r)};this.fromRGB=function(e,t,n,s){if(e!==null){e=Math.max(0,Math.min(1,e))}if(t!==null){t=Math.max(0,Math.min(1,t))}if(n!==null){n=Math.max(0,Math.min(1,n))}var o=r(e===null?this.rgb[0]:e,t===null?this.rgb[1]:t,n===null?this.rgb[2]:n);if(o[0]!==null){this.hsv[0]=Math.max(0,this.minH,Math.min(6,this.maxH,o[0]))}if(o[2]!==0){this.hsv[1]=o[1]===null?null:Math.max(0,this.minS,Math.min(1,this.maxS,o[1]))}this.hsv[2]=o[2]===null?null:Math.max(0,this.minV,Math.min(1,this.maxV,o[2]));var u=i(this.hsv[0],this.hsv[1],this.hsv[2]);this.rgb[0]=u[0];this.rgb[1]=u[1];this.rgb[2]=u[2];this.exportColor(s)};this.fromString=function(e,t){var n=e.match(/^\W*([0-9A-F]{3}([0-9A-F]{3})?)\W*$/i);if(!n){return false}else{if(n[1].length===6){this.fromRGB(parseInt(n[1].substr(0,2),16)/255,parseInt(n[1].substr(2,2),16)/255,parseInt(n[1].substr(4,2),16)/255,t)}else{this.fromRGB(parseInt(n[1].charAt(0)+n[1].charAt(0),16)/255,parseInt(n[1].charAt(1)+n[1].charAt(1),16)/255,parseInt(n[1].charAt(2)+n[1].charAt(2),16)/255,t)}return true}};this.toString=function(){return(256|Math.round(255*this.rgb[0])).toString(16).substr(1)+(256|Math.round(255*this.rgb[1])).toString(16).substr(1)+(256|Math.round(255*this.rgb[2])).toString(16).substr(1)};var m=this;var g=this.pickerMode.toLowerCase()==="hvs"?1:0;var y=false;var b=jscolor.fetchElement(this.valueElement),w=jscolor.fetchElement(this.styleElement);var E=false,S=false,x={};var T=1<<0,N=1<<1,C=1<<2,k=1<<3;jscolor.addEvent(e,"focus",function(){if(m.pickerOnfocus){m.showPicker()}});jscolor.addEvent(e,"blur",function(){if(!y){window.setTimeout(function(){y||c();y=false},0)}else{y=false}});if(b){var L=function(){m.fromString(b.value,T);v()};jscolor.addEvent(b,"keyup",L);jscolor.addEvent(b,"input",L);jscolor.addEvent(b,"blur",h);b.setAttribute("autocomplete","off")}if(w){w.jscStyle={backgroundImage:w.style.backgroundImage,backgroundColor:w.style.backgroundColor,color:w.style.color}}switch(g){case 0:jscolor.requireImage("hs.png");break;case 1:jscolor.requireImage("hv.png");break}jscolor.requireImage("cross.gif");jscolor.requireImage("arrow.gif");this.importColor()}};jscolor.install()